"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[424],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var i=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=i.createContext({}),s=function(e){var t=i.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=s(e.components);return i.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},c=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,p=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),c=s(n),m=a,h=c["".concat(p,".").concat(m)]||c[m]||d[m]||r;return n?i.createElement(h,l(l({ref:t},u),{},{components:n})):i.createElement(h,l({ref:t},u))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,l=new Array(r);l[0]=c;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:a,l[1]=o;for(var s=2;s<r;s++)l[s]=n[s];return i.createElement.apply(null,l)}return i.createElement.apply(null,n)}c.displayName="MDXCreateElement"},5118:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>s});var i=n(7462),a=(n(7294),n(3905));const r={sidebar_position:2},l="Build",o={unversionedId:"overview/build",id:"overview/build",title:"Build",description:"Cyclic apps are built and deployed into AWS from code that originates in Github.",source:"@site/docs/overview/build.md",sourceDirName:"overview",slug:"/overview/build",permalink:"/overview/build",draft:!1,editUrl:"https://github.com/cyclic-software/docs/blob/main/docs/overview/build.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Architecture",permalink:"/overview/architecture"},next:{title:"Deploy",permalink:"/overview/deploy"}},p={},s=[{value:"Code",id:"code",level:2},{value:"Customize the build process",id:"customize-the-build-process",level:2},{value:"Advanced Build Options",id:"advanced-build-options",level:3},{value:"<strong>Root Path</strong>",id:"root-path",level:4},{value:"<strong>Output Path</strong>",id:"output-path",level:4},{value:"<strong>Static Site</strong>",id:"static-site",level:4},{value:"<strong>Runtime</strong>",id:"runtime",level:4}],u={toc:s};function d(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,i.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"build"},"Build"),(0,a.kt)("head",null,(0,a.kt)("link",{rel:"stylesheet",href:"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css"})),(0,a.kt)("p",null,"Cyclic apps are built and deployed into AWS from code that originates in Github."),(0,a.kt)("p",null,"To trigger a build and deployment, install the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/apps/cyclic-sh"},"Cyclic Github app")," on any public repo. On first installation we will assign your repo to an app and give it a public url such as ",(0,a.kt)("inlineCode",{parentName:"p"},"random-words.cyclic.app"),". We will then build and deploy your app as described below. On future commits to the default branch (for example: merges of PRs or pushes) Github will send a webhook api call to us. We will then perform the same build and deploy steps."),(0,a.kt)("p",null,"The input of the ",(0,a.kt)("strong",{parentName:"p"},"build")," step is a single commit in a git repo and the output is a zip archive that can be deployed and run inside of an AWS lambda with the Cyclic lambda runtime."),(0,a.kt)("div",{style:{textAlign:"center"}},(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Cyclic Github app installation API call pattern",src:n(3922).Z,title:"Cyclic Github app installation",width:"513",height:"311"}))),(0,a.kt)("h2",{id:"code"},"Code"),(0,a.kt)("p",null,"The following is a close approximation of the code we use to take your code repo and turn it into an artifact that can be run inside of AWS Lambda with the Cyclic lambda runtime."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Note"),": we use ",(0,a.kt)("inlineCode",{parentName:"p"},"npm")," version 8.13.1 throughout."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"npm install"),": Install your code's dependencies (including ",(0,a.kt)("inlineCode",{parentName:"li"},"devDependencies"),")"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"npm run build"),": Build your app if you have a ",(0,a.kt)("inlineCode",{parentName:"li"},"build")," script defined in ",(0,a.kt)("inlineCode",{parentName:"li"},"package.json")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"npm prune"),": Prune any ",(0,a.kt)("inlineCode",{parentName:"li"},"devDependencies")," to minimize the size of the output zip"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"zip"),": Zip all of your code and installed dependencies (for example ",(0,a.kt)("inlineCode",{parentName:"li"},"node_modules"),") recursively")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Note"),": we have limits on the maximum amount of disk space used for code + dependencies while building and on the final bundle size. See ",(0,a.kt)("a",{parentName:"p",href:"/overview/limits"},"limits page")," for more details."),(0,a.kt)("h2",{id:"customize-the-build-process"},"Customize the build process"),(0,a.kt)("p",null,"NPM executes several ",(0,a.kt)("a",{parentName:"p",href:"https://docs.npmjs.com/cli/v8/using-npm/scripts#npm-install"},"lifecycle scripts")," as part of the ",(0,a.kt)("inlineCode",{parentName:"p"},"npm install")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"npm run build"),". According to the documentation these are run in the following order:"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("inlineCode",{parentName:"strong"},"npm install"))),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"preinstall")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"install")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"postinstall")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"prepublish")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"preprepare")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"prepare")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"postprepare"))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("inlineCode",{parentName:"strong"},"npm run build"))),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"prebuild")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"build")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"postbuild"))),(0,a.kt)("p",null,"If you have particular needs try putting it into the appropriate lifecycle script. If you have needs beyond what these lifecycle scripts can provide or they don't solve for your use case send us an email: ",(0,a.kt)("i",{className:"far fa-envelope"})," ",(0,a.kt)("a",{parentName:"p",href:"mailto:hello@cyclic.sh"},"hello@cyclic.sh")," or join us on ",(0,a.kt)("a",{parentName:"p",href:"https://discord.gg/huhcqxXCbE"},(0,a.kt)("i",{className:"fab fa-discord"}),"  Discord")),(0,a.kt)("h3",{id:"advanced-build-options"},"Advanced Build Options"),(0,a.kt)("p",null,"By default, the build process and the above lifecycle scripts:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"run at the root of the repo "),(0,a.kt)("li",{parentName:"ul"},"everything at the root of the repo is bundled",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"except files specified in ",(0,a.kt)("inlineCode",{parentName:"li"},".npmignore")))),(0,a.kt)("li",{parentName:"ul"},"At runtime ",(0,a.kt)("inlineCode",{parentName:"li"},"npm run start")," is used to execute the application")),(0,a.kt)("p",null,"It is possible to customize this process with ",(0,a.kt)("em",{parentName:"p"},"Advanced Build Options"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"at the time of first deployment, in the ",(0,a.kt)("em",{parentName:"li"},"Advanced")," dropdown",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("img",{src:"/img/build-options/advancedWNode.png",width:"350px"})))),(0,a.kt)("li",{parentName:"ul"},"in  ",(0,a.kt)("em",{parentName:"li"},"Environments")," tab > ",(0,a.kt)("em",{parentName:"li"},"Build Options")," of an app's dashboard",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("img",{src:"/img/build-options/buildwithnode2.png",width:"350px"}))))),(0,a.kt)("h4",{id:"root-path"},(0,a.kt)("strong",{parentName:"h4"},"Root Path")),(0,a.kt)("p",null,"The root path specifies which directory Cyclic will run build scripts.\nFor example for a repository structured as:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"\u251c\u2500\u2500/frontend\n|   \u251c\u2500\u2500 ...\n|   \u2514\u2500\u2500 package.json\n\u251c\u2500\u2500/backend\n|   \u2514\u2500\u2500 ...\n\u2514\u2500\u2500package.json\n")),(0,a.kt)("p",null,"To have cyclic run ",(0,a.kt)("inlineCode",{parentName:"p"},"npm run build")," in the ",(0,a.kt)("inlineCode",{parentName:"p"},"frontend"),' directory, configure "Root Path" as ',(0,a.kt)("inlineCode",{parentName:"p"},"/frontend"),"."),(0,a.kt)("h4",{id:"output-path"},(0,a.kt)("strong",{parentName:"h4"},"Output Path")),(0,a.kt)("p",null,"The contents of the ",(0,a.kt)("em",{parentName:"p"},"Output Path")," are bundled for deployment. For example if at the end of the above build, a build directory is generated inside ",(0,a.kt)("inlineCode",{parentName:"p"},"/frontend"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"\u251c\u2500\u2500/frontend\n|   \u251c\u2500\u2500 build\n|   |   \u251c\u2500\u2500 index.html\n|   |   \u2514\u2500\u2500 package.json\n|   \u251c\u2500\u2500 ...\n|   \u2514\u2500\u2500 package.json\n\u251c\u2500\u2500/backend\n|   \u2514\u2500\u2500 ...\n\u2514\u2500\u2500package.json\n")),(0,a.kt)("p",null,"To make sure that the ",(0,a.kt)("em",{parentName:"p"},"build output")," are the only files to be bundled, specify ",(0,a.kt)("inlineCode",{parentName:"p"},"/frontend/build")," as the ",(0,a.kt)("em",{parentName:"p"},"Output Path"),"."),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("mdxAdmonitionTitle",{parentName:"admonition"},(0,a.kt)("inlineCode",{parentName:"mdxAdmonitionTitle"},"npm run start")),(0,a.kt)("p",{parentName:"admonition"},(0,a.kt)("strong",{parentName:"p"},"Unless the output is a static site"),", the output directory should still contain a package.json with a valid start script for run time. "),(0,a.kt)("p",{parentName:"admonition"},"Read more about the ",(0,a.kt)("a",{parentName:"p",href:"/overview/launch#start"},"launch procedure"),".")),(0,a.kt)("h4",{id:"static-site"},(0,a.kt)("strong",{parentName:"h4"},"Static Site")),(0,a.kt)("p",null,"Check this toggle if the contents of the output directory are only static files and do not contain a server instance.\nThis applies to build outputs of static site framework builds such as React, Vue, Angular, etc."),(0,a.kt)("p",null,"This video will give you an example of how to deploy a static site without a backend on Cyclic:"),(0,a.kt)("iframe",{width:"350",height:"230",src:"https://www.youtube.com/embed/-B98D6x8mBg",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowfullscreen:!0}),(0,a.kt)("h4",{id:"runtime"},(0,a.kt)("strong",{parentName:"h4"},"Runtime")),(0,a.kt)("p",null,"Newly deployed Cyclic apps will use Node.js v18.12.1 by default. If you are using a framework or library that requires an older version of Node.js to function properly, you may adjust it here."),(0,a.kt)("img",{src:"/img/build-options/runtime.png",width:"500px"}))}d.isMDXComponent=!0},3922:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/build-process.drawio-9779c9c0b971713df2e0e5bfb58789c9.png"}}]);